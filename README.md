# UR_kinematics_calib

High-accuracy Python FK & IK solver for UR5 with calibrated DH parameters.

---

## IK Implementation Status

**Current Limitations:**
- The current inverse kinematics (IK) solver uses a numerical optimization approach that may converge at local minima
- Results are sensitive to the initial joint configuration guess
- While accurate when converged correctly, the solver can produce suboptimal solutions in certain configurations

**Future Plans:**
- Integrate more robust IK solvers to improve reliability and global convergence
- Evaluating industry-standard options including:
  - [QuIK](https://github.com/steffanlloyd/quik) - An ultra-fast and highly robust kinematics library for C++ or ROS2 using DH parameters.
  - [TRAC-IK](https://bitbucket.org/traclabs/trac_ik) - Enhanced solver with better convergence than KDL's default
- Continue research on analytical methods for calibrated UR robots

**Research Resources:**
- [Analytical IK Research Summary](docs/Summary-Deep-Research.pdf) - Investigation into analytical IK approaches for calibrated parameters. *(generated by ChatGPT, some info might be wrong)*

---

## Project Structure

```
ur_kinematics_calib/
├── configs/             # calibration and UR control files
├── data/                # UR capture data (joint angles & EEF poses)
├── docs/                # documentation and plans
├── scripts/             # demo scripts
│   ├── fk_demo.py       # forward kinematics demo
│   ├── ik_demo.py       # inverse kinematics demo
│   ├── benchmark_fk.py  # benchmarks FK performance over many iterations
│   ├── benchmark_ik.py  # benchmarks IK solver speed and success rate
│   └── fk_ik_check.py   # full FK-to-IK validation
├── src/                 # package source
│   └── ur_kinematics_calib/
│       ├── util.py
│       ├── fk.py
│       └── ik.py
├── tests/               # test utilities
│   ├── dry_parse.py     # calibration & FK CLI
│   └── run_all_tests.py # automated test runner
└── README.md
```

## Dependencies

Managed with [uv](https://github.com/astral-sh/uv)  
Install uv via pip:
```bash
pip install uv
```

> [!NOTE]  
> uv will create a venv and install the required dependencies with: `uv run ..`

## Usage

### Forward Kinematics
Run the FK demo with:
```bash
uv run scripts/fk_demo.py -j 1.54,-28.43,24.41,-130.54,-37.17,-147.01
```

### Inverse Kinematics
Run the IK demo:
```bash
uv run scripts/ik_demo.py -p 159.13,-317.1,413.36,1.266,-3.32,-0.283
```

### Validation
Run IK check with:
```bash
uv run scripts/fk_ik_check.py -j 31.64,-117.58,104.85,-77.19,-82.32,-58.4
```

> [!NOTE]  
> Command Arguments:   
> `fk_demo.py` -j <deg1,deg2,deg3,deg4,deg5,deg6>  
> `ik_demo.py` -p <x,y,z,rx,ry,rz>  
> `fk_ik_check.py` -j <deg1,deg2,deg3,deg4,deg5,deg6>

### Testing

Run all tests with:
```bash
uv run tests/run_all_tests.py
```

Compare calculated FK result with actual pose:
```bash
uv run tests/dry_parse.py --compare 1.54,-28.43,24.41,-130.54,-37.17,-147.01,-872.69,-236.61,417.99,1.344,-1.557,0.494
```

## Performance

### FK Accuracy: comparing calculated value with UR controller value
- **Position error (mm):** under 0.08 mm
  - minimum: 0.0169 mm, maximum: 0.0800 mm
- **Rotation error (deg):** under 0.032 deg
  - minimum: 0.0119 deg, maximum: 0.0317 deg

### Benchmark Results
```
--- FK Benchmark Results ---
Number of iterations: 10000
Average FK calculation time: 0.0334 ms
Min FK calculation time: 0.0305 ms
Max FK calculation time: 0.3334 ms

--- IK Benchmark Results ---
Number of iterations: 1000
Average IK calculation time: 8.8979 ms
Min IK calculation time: 3.8058 ms
Max IK calculation time: 80.4694 ms
Successful IK solutions: 1000/1000 (100.00%)
Failed IK solutions (no convergence): 0
```